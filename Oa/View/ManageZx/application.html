<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>苗博士CRM网络管理系统</title>
    <link href="{$Think.const.CSS_URL}/bootstrap.min.css?v=3.3.5" rel="stylesheet">
    <link href="{$Think.const.CSS_URL}/animate.min.css" rel="stylesheet">
    <link href="{$Think.const.CSS_URL}/font-awesome.min.css" rel="stylesheet">
    <link href="{$Think.const.CSS_URL}/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="{$Think.const.CSS_URL}/plugins/summernote/summernote.css" rel="stylesheet">
    <link href="{$Think.const.CSS_URL}/plugins/summernote/summernote-bs3.css" rel="stylesheet">
    <link href="{$Think.const.CSS_URL}/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css"
          rel="stylesheet">
    <link href="{$Think.const.CSS_URL}/style.min.css?v=3.2.0" rel="stylesheet">

</head>
<style>
    #pic {
        position: absolute;
        display: none;
    }

    #pic1 {
        width: 400px;
        height: 300px;
        border-radius: 5px;
        -webkit-box-shadow: 5px 5px 5px 5px hsla(0, 0%, 5%, 1.00);
        box-shadow: 5px 5px 5px 0px hsla(0, 0%, 5%, 0.3);
    }
</style>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInUp">
    <form action="__URL__/application" method="post" id="contact-form">
        <div class="col-sm-12">
            <div class="ibox float-e-margins" id="shoujisf1">
                <div class="ibox-title">
                    <h5><a class="collapse-link">保留申请</a></h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-wrench" id="shoujisf2"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content" style="padding-left:0px;padding-right:0px;" id="shoujisf3">
                    <div class="col-sm-3">
                        <div class="input-group m-b">
                            <span class="input-group-addon"><font color="{$yanse}">所属门店</font></span>
                            <select class="form-control" name="yy_ID" id="register0">
                                <if condition="$countyy gt 1">
                                    <option value="">所有门店</option>
                                </if>
                                <volist name="ssyy" id="vo">
                                    <if condition="$vo.yyid eq $dqyyID">
                                        <option value="{$vo.yyid}" selected="selected">{$vo.yyname}</option>
                                        <else/>
                                        <option value="{$vo.yyid}">{$vo.yyname}</option>
                                    </if>
                                </volist>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="input-group m-b">
                            <span class="input-group-addon"><font color="{$yanse2}">状态</font></span>
                            <select class="form-control" name="appstatus" id="appstatus">
                                <option value="">所有</option>
                                <option value="1"
                                <if condition="$appstatus eq 1"> selected="selected"</if>
                                >未审核</option>
                                <option value="2"
                                <if condition="$appstatus eq 2"> selected="selected"</if>
                                >审核通过</option>
                                <option value="3"
                                <if condition="$appstatus eq 3"> selected="selected"</if>
                                >审核未通过</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="input-group m-b">
                            <span class="input-group-addon"><font color="{$yanse2}">客服</font></span>
                            <select class="form-control" name="kefu" id="">
                                <option value="">所有</option>
                                <volist name="zixunyuan1" id="zixunyuan11">
                                    <if condition="($zixunyuan11.user_ID == $dqzxy)">
                                        <option value="{$zixunyuan11.user_ID}" selected="selected">
                                            {$zixunyuan11.userchinaname}
                                        </option>
                                        <else/>
                                        <option value="{$zixunyuan11.user_ID}">{$zixunyuan11.userchinaname}
                                        </option>
                                    </if>
                                </volist>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="input-group m-b">
                            <span class="input-group-addon"><font color="{$yanse7}">手机号/姓名</font></span>
                            <input name="shouji" type="text" value="{$serchshouji}" class="form-control"/>
                        </div>
                    </div>
                    <div class="col-sm-3" style="padding-left:0px;padding-right:0px;">
                        <div class="form-group">
                            <label class="col-sm-12 control-label">咨询时间</label>
                            <div class="col-md-6">
                                <input name="zixun_timeStart" type="text" class="form-control layer-date"
                                       placeholder="YYYY-MM-DD" value="{$zixun_timeStart}" id="shijian31"/>
                            </div>
                            <div class="col-md-6">
                                <input name="zixun_timeEnd" type="text" class="form-control layer-date"
                                       placeholder="YYYY-MM-DD" value="{$zixun_timeEnd}" id="shijian32"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3" style="padding-left:0px;padding-right:0px;">
                        <div class="form-group">
                            <label class="col-sm-12 control-label">申请时间</label>
                            <div class="col-md-6">
                                <input name="apply_timeStart" type="text" class="form-control layer-date"
                                       placeholder="YYYY-MM-DD" value="{$apply_timeStart}" id="shijian31"/>
                            </div>
                            <div class="col-md-6">
                                <input name="apply_timeEnd" type="text" class="form-control layer-date"
                                       placeholder="YYYY-MM-DD" value="{$apply_timeEnd}" id="shijian32"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-sm-12 control-label">&nbsp;</label>
                        <button class="btn btn-primary" type="submit" name="submit1" value="确定">确定筛选</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="col-sm-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5><a class="collapse-link">申请清单</a></h5>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-wrench"></i>
                    </a>
                </div>
            </div>
            <div class="ibox-content">
                <table class="table table-striped table-bordered table-hover dataTables-example"
                       style=" width:100% !important;">
                    <thead>
                    <tr>
                        <th>申请人</th>
                        <th class="hidden-xs">客户</th>
                        <th class="hidden-xs">手机号</th>
                        <th>申请理由</th>
                        <th class="hidden-xs">聊天记录</th>
                        <th class="hidden-xs">咨询时间</th>
                        <th class="hidden-xs">申请时间</th>
                        <th class="hidden-xs">状态</th>
                        <if condition="$role_ID == 1 ">
                            <th class="hidden-xs">操作</th>
                            <else/>
                            <th class="hidden-xs">结果说明</th>
                        </if>
                    </tr>
                    </thead>
                    <tbody>
                    <volist name='appinfo' id='vo'>
                        <tr>

                            <td>{$vo.userchinaname}</td>
                            <td class="hidden-xs">{$vo.huanzeName}</td>
                            <td class="hidden-xs">{$vo.shouji}</td>
                            <td>{$vo.beizhu}</td>
                            <td class="hidden-xs container" style="width:13rem">
                                <php>
                                    if(!empty($vo['appsrc'])){
                                    $src = explode(',',$vo['appsrc']);
                                    $date = str_replace('-','',substr($vo['apply_time'],0,10));
                                    foreach($src as $k){
                                </php>
                                <a style="border:1px solid #fff;"
                                   href="{$Think.const.SITEURL}/upload/<php> echo $date.'/'.$k;</php>"><img
                                        src="{$Think.const.SITEURL}/upload/<php> echo $date.'/'.$k;</php>" width="36"
                                        height="36"></a>
                                <php>
                                    }
                                    }
                                </php>
                            </td>
                            <td class="hidden-xs">{$vo.zx_time}</td>
                            <td class="hidden-xs">{$vo.apply_time}</td>
                            <td class="hidden-xs">
                                <if condition="$vo['status']==1">未审核
                                    <elseif condition="$vo['status']==2"/>
                                    审核通过
                                    <elseif condition="$vo['status']==3"/>
                                    审核不通过
                                </if>
                            </td>
                            <if condition="$vo['status']==1 && $role_ID==1">
                                <td class="hidden-xs" zid="{$vo.zx_ID}" appid="{$vo.apply_id}">
                                    <span style="cursor: pointer;" class="badge badge-danger" onclick="passapply(this)">通过</span>
                                    <span style="margin-left: 8px;cursor: pointer;" class="badge badge-danger"
                                          onclick="unallow(this);">驳回</span>
                                </td>
                                <elseif condition="$vo['status']==3"/>
                                <td>
                                    {$vo.result}
                                </td>
                                <else/>
                                <td>{$role}</td>
                            </if>
                        </tr>
                    </volist>
                    </tbody>
                </table>
                <!--   <div style="margin-top:-20px; margin-bottom:10px;">
                  <form method="POST" action="__URL__/ExcleDC_zixunyuan">
                  <input type="hidden" name="excle" value='{$daochu}' />
                  <input type="hidden" name="excle1" value='{$daochu_heji}' />
                  <input type="submit" name="submit_1" class="btn btn-white btn-sm" value="全部导出xls">
                  </form>
                  </div>  -->
            </div>
        </div>
    </div>
</div>
<div class="layui-layer-shade" style="z-index:19891019; background:url({$Think.const.IMG_URL}/kong.png); display:none;"
     id="bohuixxyy">
    <div class="layui-layer layui-anim layui-layer-page layer-ext-moon"
         style="z-index: 19891020; width:310px; height:250px; left:50%; margin-left:-155px;">
        <div class="layui-layer-title" style="cursor: move;">申请驳回</div>
        <div class="layui-layer-content">
            <div class="animated">
                <div class="ibox float-e-margins" style="margin-bottom:0px;">
                    <div class="ibox-content">
                        <div class="input-group m-b" style="margin-bottom:5px;"><span
                                class="input-group-addon">驳回说明</span>
                            <input class="form-control" name="bohui_result" type="text" id="fuzhi1" value=""/>
                            <input name="zid" type="hidden" value=""/>
                            <input name="appid" type="hidden" value=""/>
                        </div>
                        <div class="form-group" align="center" style="margin-bottom:5px;">
                            <button class="btn btn-primary" onclick="onsubmitbohui(this);" name="">确定驳回</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <span class="layui-layer-setwin" id="bohuixx"><a class="layui-layer-ico layui-layer-close layui-layer-close1"
                                                         href="javascript:;"></a></span>
    </div>
</div>
<!-- 全局js -->
<script src="{$Think.const.JS_URL}/jquery.min.js"></script>
<script src="{$Think.const.JS_URL}/bootstrap.min.js?v=3.3.5"></script>
<!-- layerjs -->
<script src="{$Think.const.JS_URL}/plugins/layer/layer.min.js"></script>
<!-- 自定义js -->
<script src="{$Think.const.JS_URL}/content.min.js?v=1.0.0"></script>
<!-- layerDate plugin javascript -->
<script src="{$Think.const.JS_URL}/plugins/layer/laydate/laydate.js"></script>
<!-- Data Tables -->
<link href="{$Think.const.CSS_URL}/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
<script src="{$Think.const.JS_URL}/plugins/dataTables/jquery.dataTables.js"></script>
<script src="{$Think.const.JS_URL}/plugins/dataTables/dataTables.bootstrap.js"></script>
<!--<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>-->
<script>
    $(document).ready(function () {
        var shijian31 = {
            elem: '#shijian31',
            format: 'YYYY-MM-DD',
            istime: false,
            istoday: true,
            choose: function (datas) {
                shijian32.min = datas; //开始日选好后，重置结束日的最小日期
                shijian32.start = datas //将结束日的初始值设定为开始日
            }
        };
        var shijian32 = {
            elem: '#shijian32',
            format: 'YYYY-MM-DD',
            istime: false,
            istoday: true,
            choose: function (datas) {
                shijian31.max = datas; //结束日选好后，重置开始日的最大日期
            }
        };
        laydate(shijian31);
        laydate(shijian32);

        $(".dataTables-example").dataTable({pageLength: 10});  //表格排序

        $(".container a").hover(function () {
            $(this).append("<p id='pic'><img src='" + this.href + "' id='pic1'></p>");
            $(".container a").mousemove(function (e) {
                $("#pic").css({
                    "top": (e.pageY - 150) + "px",
                    "left": (e.pageX + 10) + "px"
                }).fadeIn("fast");
                // $("#pic").fadeIn("fast");
            });
        }, function () {
            $("#pic").remove();
        });
    });

    function passapply(e) {
        var zid = $(e).parent().attr('zid');
        var appid = $(e).parent().attr('appid');
        var msg = "请确认！";
        if (confirm(msg) == true) {
            $.ajax({
                type: "post",
                url: "{$Think.const.DQURL}ManageZx/changeapply",
                data: {"zx_id": zid, 'appid': appid},
                dataType: "json",
                success: function (data) {
                    if (data) {
                        if (data.code == 200) {
                            layer.msg(data.msg);
                            $(e).parent().prev().text('审核通过');
                        } else {
                            layer.msg(data.msg);
                        }
                    }
                },
                error: function (data) {
                    layer.msg(data.msg);
                    return false;
                }
            });
        } else {
            return false;
        }
    }

    function unallow(e) {
        $('#bohuixxyy').show();
        var zid = $(e).parent().attr('zid');
        var appid = $(e).parent().attr('appid');
        $("input[name='zid']").val('');
        $("input[name='appid']").val('');
        $("input[name='zid']").val(zid);
        $("input[name='appid']").val(appid);

    }

    $('#bohuixx').on('click', function () {
        $('#bohuixxyy').hide();
    })

    function onsubmitbohui(e) {
        var zid = $("input[name='zid']").val();
        var appid = $("input[name='appid']").val();
        var shuoming = $("input[name='bohui_result']").val().replace(/(^\s*)|(\s*$)/g, "");
        if (shuoming == '' || shuoming == null || shuoming == undefined) {
            layer.msg('驳回说明不能为空');
            console.log(111111);
            return false;
        }
        if (!(parseInt(zid) > 0) || !(parseInt(appid) > 0)) {
            layer.msg('用户或申请单不存在！');
            $('#bohuixxyy').hide();
            return false;
        }
        $.ajax({
            type: "post",
            url: "{$Think.const.DQURL}ManageZx/changeapply",
            data: {"zx_id": zid, 'appid': appid, 'shuoming': shuoming, 'sign': 2},
            dataType: "json",
            success: function (data) {
                if (data) {
                    if (data.code == 200) {
                        layer.msg(data.msg);
                    } else {
                        layer.msg(data.msg);
                    }
                }
            },
            error: function (data) {
                layer.msg(data.msg);
                return false;
            }
        });
    }

</script>
</body>
</html>

