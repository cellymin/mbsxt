<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>苗博士CRM网络管理系统</title>
<link href="{$Think.const.CSS_URL}/bootstrap.min.css?v=3.3.5" rel="stylesheet">
<link href="{$Think.const.CSS_URL}/animate.min.css" rel="stylesheet">
<link href="{$Think.const.CSS_URL}/font-awesome.min.css" rel="stylesheet">
<link href="{$Think.const.CSS_URL}/plugins/iCheck/custom.css" rel="stylesheet">
<link href="{$Think.const.CSS_URL}/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
<link href="{$Think.const.CSS_URL}/style.min.css?v=3.2.0" rel="stylesheet">

</head>
<body  class="gray-bg">
<div class="wrapper wrapper-content animated fadeInUp">
<form action="__URL__/report_shijianduan_jihua" method="post" id="contact-form" onsubmit="return jihua_yanzheng()">
<div class="col-sm-12">
    <div class="ibox float-e-margins" id="shoujisf1">
        <div class="ibox-title">
            <h5><a class="collapse-link">时间段报表 筛查选项</a></h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-wrench" id="shoujisf2"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content" style="padding-left:0px;padding-right:0px;" id="shoujisf3">
                <div class="col-sm-3">
                    <div class="input-group m-b">
                    <span class="input-group-addon"><font color="{$yanse}">所属门店</font></span>
                    <select class="form-control" name="yy_ID" id="register0">
                      <option value="">所有门店</option>
                      <volist name="ssyy" id="vo">
                      <if condition="$vo.yyid eq $dqyyID">
                      <option value="{$vo.yyid}" selected="selected">{$vo.yyname}</option>
                      <else/>
                      <option value="{$vo.yyid}">{$vo.yyname}</option>
                      </if>
                      </volist>
                    </select>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="input-group m-b">
                    <span class="input-group-addon"><font color="{$yanse1}">百度账户</font></span>
                    <select class="form-control" name="zhanghuID" id="baiduzhanghao" >
                      <option value="">所有账户</option>
                        <volist name="zhanghurow" id="vo">
                            <if condition="$vo.zhanghu_ID eq $zhanghuID">
                              <option value="{$vo.zhanghu_ID}" selected="selected">{$vo.zhanghuming}</option>
                              <else/>
                              <option value="{$vo.zhanghu_ID}">{$vo.zhanghuming}</option>
                            </if>
                         </volist>
                    </select>
                    </div>
                </div>
				        <div class="col-sm-3">
					        <div class="input-group m-b">
					          <span class="input-group-addon"><font color="{$yanse1}">咨询量来源</font></span>
					          <select class="form-control" name="zixunlaiyuan" id="zixunlaiyuan">
						        <option value="1" {$selectd2}>咨询员录入</option>
						        <option value="0" {$selectd1}>商务通导入</option>
					          </select>
					        </div>
			          </div>
                <div class="col-sm-3" id="swtxuanxiang" style="display:none;">
                    <div class="input-group m-b">
                    <span class="input-group-addon"><font color="{$yanse3}">商务通数据</font></span>
                    <select name="swtsj" class="form-control">
						        <option value="1" {$selectd_swtzong}>商务通咨询总数据</option>
						        <option value="0" {$selectd_swtbaidu}>百度竞价咨询数据</option>
                    </select>
                    </div>
                </div>
                <div class="col-sm-3" id="zxfangshi">
                    <div class="input-group m-b">
                    <span class="input-group-addon"><font color="{$yanse3}">咨询方式</font></span>
                    <select name="zxfs_ID" id="userinfo0" class="form-control zxfspdxj">
                      <if condition="$dqyyID eq ''">
                      <option value="">所有</option>
                      <else />
                       {$cishu|Zxfs_down_Eyy2=0,$morenZxfsID,0,$dqyyID,###}
                      </if>
                    </select>
                    </div>
                </div>
				 <div class="col-sm-3" id="xxbinzhong">
                    <div class="input-group m-b">
                    <span class="input-group-addon"><font color="{$yanse2}">所属病种</font></span>
                      <select name="bz_ID" id="userinfoBZ" class="form-control">
                       <if condition="$dqyyID eq ''">
                          <option value="">所有</option> 		  
                        <else />
                          {$cishu|Column_down_Eyy2=0,$morenBzID,0,$dqyyID,###}
                       </if>
                      </select>
                    </div>
                </div>
                <div class="col-sm-3" id="xxlaiyuan">
                    <div class="input-group m-b">
                    <span class="input-group-addon"><font color="{$yanse5}">信息来源</font></span>
                      <select name="xx_ID" id="userinfoXxly" class="form-control">
                       <option value="">请选择信息来源</option>
                      <volist name="xinxidata" id="voxinxi">
                          <if condition="$voxinxi.ID eq $morenxxID">
                          <option value="{$voxinxi.ID}" selected="selected">{$voxinxi.xx_name}</option>
                          <else />
                          <option value="{$voxinxi.ID}">{$voxinxi.xx_name}</option>
                          </if>
                      </volist>
                      </select>
                    </div>
                </div>
                <div class="col-sm-3" id="shijian11" style="padding-left:0px;padding-right:0px;">
                    <div class="col-sm-6">
                    <div class="input-group m-b" style="width:100%;">
                    <input name="zx_timeStart" type="text" class="form-control layer-date" id="shijian1" placeholder="YYYY-MM-DD" value="{$zx_timeStart}"/>
                    <span class="input-group-addon" id="visible-xs">开始时间</span>
                    </div>
                    </div>
                    <div class="col-sm-6">
                    <div class="input-group m-b" style="width:100%;">
                    <input name="zx_timeEnd" type="text" class="form-control layer-date" id="shijian2" placeholder="YYYY-MM-DD"  value="{$zx_timeEnd}"/>
                    <span class="input-group-addon" id="visible-xs">结束时间</span>
                    </div>
                    </div>
                </div>
                <div class="col-sm-3">
                  <div class="col-xs-6">
                   <button class="btn btn-info" type="button" id="Plan_screening">获取计划</button>
                  </div>
                  <div class="col-xs-6">
                   <button class="btn btn-primary" name='submit' value="submit" type="submit" id="xuanzhongz">确定筛选</button>
                  </div>
                </div>
        </div>
    </div>
</div>

<div class="layui-layer-shade" style="z-index:19891019; background:url({$Think.const.IMG_URL}/kong.png); display:none;" id="Plan_screeningnn">
  <div class="layui-layer layui-anim layui-layer-page layer-ext-moon" style="z-index: 19891020; width:95%; height:95%; left:2.5%; top:2.5%;">
    <div class="layui-layer-title" style="cursor: move;">计划筛选</div>
    <div class="layui-layer-content">
  <div class="col-sm-12" id="screeningwk">
      <div class="ibox float-e-margins">
        <div class="ibox-content" style="margin-bottom:0px;">
        <div id="screeningnr">
  <table class="table table-striped table-bordered table-hover display" cellspacing="0" id="screening">
      <thead>
          <tr>
              <th nowrap><input type="checkbox" id="checkAll"><label for="checkAll"> 选择</label></th>
              <th nowrap>计划</th>
          </tr>
      </thead>
      <tbody id="jihuaneirong">
            <volist name='campaign' id='vo'>
             <tr>
              <td><input type="checkbox" name="campaignxz[]" value="{$vo.campaignName}|"></td>
              <td>{$vo.campaignName}</td>
             </tr>
			</volist>
      </tbody>
  </table>
        </div>
  <div class='form-group' align='center' style='margin-bottom:5px;'><button id="Plan_screeningqd" class='btn btn-primary' type='button'>确定选择</button></div>
        </div>
      </div>
  </div>
    </div>
<span class="layui-layer-setwin" id="Plan_screeningxx"><a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;"></a></span>
  </div>
</div>

</form>
<if condition="$tubiao_zixun neq null">
<div class="col-sm-12 hidden-xs">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5><a class="collapse-link">图形报表</a></h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-wrench"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content" style="margin-bottom:0px; padding-bottom:0px;">
         <div class="echarts" id="echarts-bar-chart"></div>
        </div>
    </div>
</div>
</if>

<div class="col-sm-12">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5><a class="collapse-link">时间段报表</a></h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-wrench"></i>
                </a>
            </div>
        </div>
      <div class="ibox-content" style="margin-bottom:0px; padding-bottom:0px;">
        <div class="alert alert-warning alert-dismissable hidden-xs">
         <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
         {$xzjh}
        </div>
      
        <table class="table table-striped table-bordered table-hover dataTables-example" style=" width:100% !important;">
            <thead>
                <tr>
                    <th nowrap>时间段</th>
                    <th nowrap>消费合计</th>
                    <th nowrap class="hidden-xs">展现合计</th>
                    <th nowrap class="hidden-xs">点击合计</th>
                    <th nowrap>咨询量</th>
					<th nowrap class="hidden-xs">预约量</th>
					<th nowrap class="hidden-xs">到诊量</th>
                    <th nowrap class="hidden-xs">咨询成本</th>
                    <th nowrap class="hidden-xs">咨询率</th>
                    <th nowrap class="hidden-xs">点击率</th>
                </tr>
            </thead>
            <tbody>
            <volist name='shiduanheji' id='vo'>
                   <tr>
                    <td><a href="javascript:void(0);" onClick="hfjl('__URL__/report_shijianduan_keyword?{$shijianduan_keyword}')">{$vo.shijiandian}</a></td>
                    <td>¥{$vo.xiaofei}</td>
                    <td class="hidden-xs">{$vo.zhanxian}</td>
                    <td class="hidden-xs">{$vo.dianji}</td>
                    <td>{$vo.shijianzixun}</td>
					<td class="hidden-xs">{$vo.shijianyuyue}</td>
					<td class="hidden-xs">{$vo.shijiandaozhen}</td>
                    <td class="hidden-xs">¥{$vo.zixunchengben}</td>
                    <td class="hidden-xs">{$vo.zixunlv}</td>
                    <td class="hidden-xs">{$vo.dianjilv}</td>
                   </tr>
            </volist>
            </tbody>
                <tfoot>
				     <tr style="background-color:#fcf8e3">
						<td>合计</td>
						<td>¥{$sdheji['xiaofei']}</td>
						<td class="hidden-xs">{$sdheji['zhanxian']}</td>
						<td class="hidden-xs">{$sdheji['dianji']}</td>
						<td>{$sdheji['shijianzixun']}</td>
						<td class="hidden-xs">{$sdheji['shijianyuyue']}</td>
						<td class="hidden-xs">{$sdheji['shijiandaozhen']}</td>
						<td class="hidden-xs">¥{$sdheji['zixunchengben']}</td>
						<td class="hidden-xs">{$sdheji['zixunlv']}</td>
						<td class="hidden-xs">{$sdheji['dianjilv']}</td>
                   </tr>
                    <tr>
                       <td class="hidden-xs" style="white-space:nowrap" colspan="10">
                      <form method="POST" action="__URL__/ExcleDC_shijianduan">
                        <input type="hidden" name="excle" value='{$daochu}' />
                        <input type="hidden" name="excle1" value='{$daochu_heji}' />
                        <input type="submit" name="submit_1" class="btn btn-white btn-sm" value="全部导出xls">
                       </form>
                        </td>
                    </tr>
                </tfoot>
        </table>
      </div>
    </div>
</div>
</div>

<!-- 全局js -->
<script src="{$Think.const.JS_URL}/jquery.min.js"></script>
<script src="{$Think.const.JS_URL}/bootstrap.min.js?v=3.3.5"></script>
<!-- layerjs -->
<script src="{$Think.const.JS_URL}/plugins/layer/layer.min.js"></script>
<!-- 自定义js -->
<script src="{$Think.const.JS_URL}/content.min.js?v=1.0.0"></script>
<!-- layerDate plugin javascript -->
<script src="{$Think.const.JS_URL}/plugins/layer/laydate/laydate.js"></script>
<!-- Data Tables -->
<link href="{$Think.const.CSS_URL}/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
<script src="{$Think.const.JS_URL}/plugins/dataTables/jquery.dataTables.js"></script>
<script src="{$Think.const.JS_URL}/plugins/dataTables/dataTables.bootstrap.js"></script>
<!--二级联动-->
<script type="text/javascript">
function hfjl(hfjh_url){
parent.layer.open({
    type: 2,
    title: '同时段详情',
    shadeClose: true,
    shade: 0.8,
    area: ['90%', '96%'],
    content: hfjh_url //iframe url
});
};
$(document).ready(function() {
var shijian1 = {
    elem: '#shijian1',
    format: 'YYYY-MM-DD',
    istoday: true,
    choose: function(datas){
    shijian2.min = datas;
    }
};
var shijian2 = {
    elem: '#shijian2',
    format: 'YYYY-MM-DD',
    istoday: true,
    choose: function(datas){
    shijian1.max = datas;
    }
};
laydate(shijian1);
laydate(shijian2);

$('#Plan_screening').on('click', function(){ //计划筛选弹窗
  var baiduzhanghaoA = $('#baiduzhanghao').val();
  if (baiduzhanghaoA != '') { //判断账户
	  layer.load();
	  $.ajax({ //计划联动
	  type:"post",
	  url:"{$Think.const.DQURL}Baidutongji/report_shijianduan_jihua_huoqu",
	  data:"zhanghuID=" + $("#baiduzhanghao").val(),
	  success:function(msg){
		$("#Plan_screeningnn").show();
		$("#screeningwk").css("height",$(".layui-layer").height()-38+"px");
		$("#screeningwk").css("overflow-y","auto");
		$("#screeningnr").html(msg);
		setTimeout(function(){
		layer.closeAll('loading');
		}, 500);
		$('#screening').DataTable({pageLength:100});
	  }
	  });
  } else {
	  parent.layer.msg('请先选择账户');
  }

});
$('#Plan_screeningqd').on('click', function(){
$('#Plan_screeningnn').hide();
});
$('#Plan_screeningxx').on('click', function(){
$('#Plan_screeningnn').hide();
});
$('#screeningwk').on('click', "#checkAll", function() {
  if ($(this).is(':checked')) { //checkbox全选
	  $("input[name='campaignxz[]']").prop("checked", true);
  } else {
	  $("input[name='campaignxz[]']").removeAttr("checked");
  }
});

$("#register0").change(function(){  //二级联动
$.ajax({ //咨询方式联动
type:"post",
url:"{$Think.const.DQURL}Addzixun/ZiXunLianDong",
data:"username=" + $("#register0").val(),
success:function(msg){
$("#userinfo0").html(msg);
}
});
$.ajax({ //信息来源联动
type:"post",
url:"{$Think.const.DQURL}Addzixun/xxlyLianDong",
data:"xxid=" + $("#register0").val(),
success:function(msg){
$("#userinfoXxly").html(msg);
}
});
$.ajax({ //病种来源联动
type:"post",
url:"{$Think.const.DQURL}Addzixun/bzLianDong",
data:"bzid=" + $("#register0").val(),
success:function(msg){
$("#userinfoBZ").html(msg);
}
});
$.ajax({ //百度账号联动
type:"post",
url:"{$Think.const.DQURL}Baidutongji/baiduliandong",
data:"yy_ID=" + $("#register0").val(),
success:function(msg){
$("#baiduzhanghao").html(msg);
}
});
});

if ($("#zixunlaiyuan").val()==0) {
  $("#zxfangshi").hide();
  $("#xxlaiyuan").hide();
  $("#xxbinzhong").hide();
  $("#swtxuanxiang").show();
  }else {
  $("#zxfangshi").show();
  $("#xxbinzhong").show();
  $("#xxlaiyuan").show();
  $("#swtxuanxiang").hide();
  }
$("#zixunlaiyuan").change(function(){ //咨询量来源
if ($("#zixunlaiyuan").val()==0)  {
  $("#zxfangshi").hide();
  $("#xxlaiyuan").hide();
  $("#xxbinzhong").hide();
  $("#swtxuanxiang").show();
  }else{
  $("#zxfangshi").show();
  $("#xxlaiyuan").show();
  $("#xxbinzhong").show();
  $("#swtxuanxiang").hide();
  }
});

$(".dataTables-example").dataTable({pageLength:25});  //表格排序
$('#screening').DataTable({pageLength:100});

});
function jihua_yanzheng(){
  var jihua_yanzhengA = $('input[name="campaignxz[]"]').val();
  if (jihua_yanzhengA == undefined) { //判断计划
	parent.layer.msg('请先勾选计划');
   return false;
  } else {
   //loading层
	var index = layer.load(2,{
	  shade: [0.3,'#000'] //0.1透明度的白色背景
	});
   return true;
  }
};
</script>

<if condition="$tubiao_zixun neq ''">
<!-- ECharts -->
<script src="{$Think.const.JS_URL}/plugins/echarts/echarts-all.js"></script>
<script>
    var i = echarts.init(document.getElementById("echarts-bar-chart"));
    var q = {
    title : {
        text: ' 时间段统计图',
        subtext: ' {$zx_timeStart} - {$zx_timeEnd}'
    },
        tooltip: {
            trigger: "axis"
        },
        legend: {
            data:['消费','咨询成本','点击','咨询量','预约量','到诊量']
        },
    toolbox: {
        show : true,
        feature : {
            mark : {show: false},
            dataView : {show: false, readOnly: false},
            magicType : {show: true, type: ['line', 'bar']},
            restore : {show: false},
            saveAsImage : {show: true}
        }
    },
        xAxis: [{
            type: "category",
            data : [{$tubiao_riqi}]
        }],
        yAxis: [{
            type : 'value',
            name : '',
            axisLabel : {
                formatter: '{value} ￥'
            }
        },
        {
            type : 'value',
            name : '',
            axisLabel : {
                formatter: '{value}'
            }
        }],
        series: [{
            name: "消费",
            type: "line",
            data: [{$tubiao_toufang}],
			itemStyle: {normal: {
				 label : {show: true}
			}},
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        },
        {
            name: "咨询成本",
            type: "line",
            data: [{$tubiao_zixunchengben}],
			itemStyle: {normal: {
				 label : {show: true}
			}},
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        },
        {
            name: "点击",
            type: "line",
			yAxisIndex: 1,
            data: [{$tubiao_dianji}],
			itemStyle: {normal: {
				 label : {show: true}
			}},
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        },
        {
            name: "咨询量",
            type: "line",
			yAxisIndex: 1,
            data: [{$tubiao_zixun}],
			itemStyle: {normal: {
				 label : {show: true}
			}},
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        },
        {
            name: "预约量",
            type: "line",
			yAxisIndex: 1,
            data: [{$tubiao_yuyue}],
			itemStyle: {normal: {
				 label : {show: true}
			}},
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        },
        {
            name: "到诊量",
            type: "line",
			yAxisIndex: 1,
            data: [{$tubiao_daozhen}],
			itemStyle: {normal: {
				 label : {show: true}
			}},
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        }
		]
    };
    i.setOption(q);
    window.onresize = i.resize;
</script>
</if>
</body>
</html>
